<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Curricular Arquitectura</title>
    <style>
        :root {
            --verde-oscuro: #6b8e23;
            --verde-medio: #8fb04d;
            --verde-claro: #e2ecd7;
            --fondo: #f8f9f3;
            --gris-bloqueo: #e0e0e0;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--fondo); margin: 0; padding: 20px; color: #333; }
        
        h1 { text-align: center; color: #4a611a; text-transform: uppercase; letter-spacing: 2px; }

        /* --- Barra de Progreso Estilo Captura --- */
        .progreso-container { width: 80%; max-width: 800px; margin: 0 auto 30px; text-align: center; }
        .porcentaje-texto { font-weight: bold; margin-bottom: 10px; color: #555; }
        .progreso-bar { width: 100%; background-color: var(--verde-claro); border-radius: 20px; height: 12px; overflow: hidden; margin-bottom: 15px; }
        .progreso-fill { height: 100%; width: 0%; background-color: var(--verde-medio); transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        #mensajeMotivacion { font-style: italic; color: #666; font-size: 0.9em; margin-bottom: 20px; min-height: 1.2em; }

        /* --- Bot√≥n Reiniciar --- */
        #reiniciarBtn { background-color: #9eb17a; color: white; border: none; border-radius: 20px; padding: 8px 25px; cursor: pointer; font-size: 0.9em; transition: 0.3s; }
        #reiniciarBtn:hover { background-color: var(--verde-oscuro); }

        /* --- Malla Estilo Tarjetas --- */
        .malla { display: flex; gap: 20px; overflow-x: auto; padding-bottom: 30px; scrollbar-width: thin; }
        .anio { min-width: 280px; background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .anio h2 { text-align: center; color: #4a611a; border-bottom: 2px solid var(--verde-claro); padding-bottom: 10px; }
        
        .semestre h3 { text-align: center; font-size: 1em; color: #777; margin-top: 20px; }

        /* --- Materias y Tooltips --- */
        .materia { 
            background: white; border: 1px solid #eee; margin: 8px 0; padding: 12px; border-radius: 10px; 
            cursor: pointer; text-align: center; font-size: 0.85em; position: relative; transition: 0.2s;
        }
        .materia.aprobada { background: var(--verde-medio) !important; color: white; border-color: var(--verde-oscuro); text-decoration: line-through; }
        .materia.bloqueada { background: #fdfdfd; color: #bbb; cursor: not-allowed; }

        /* Tooltip din√°mico */
        .materia::after {
            content: attr(data-tooltip);
            position: absolute; bottom: 120%; left: 50%; transform: translateX(-50%);
            background: #333; color: white; padding: 8px; border-radius: 5px;
            font-size: 0.8em; white-space: normal; width: 180px; z-index: 10;
            opacity: 0; visibility: hidden; transition: 0.3s; pointer-events: none;
        }
        .materia:hover::after { opacity: 1; visibility: visible; }

        /* Adaptaci√≥n para celular (toque largo o simple) */
        @media (max-width: 768px) {
            .malla { flex-direction: column; align-items: center; }
            .anio { width: 90%; }
        }
    </style>
</head>
<body>

    <h1>Malla Curricular Arquitectura</h1>

    <div class="progreso-container">
        <p class="porcentaje-texto" id="porcentajeProgreso">Progreso: 0%</p>
        <div class="progreso-bar"><div class="progreso-fill" id="progresoFill"></div></div>
        <div id="mensajeMotivacion">Todo gran proyecto empieza con una idea üå±</div>
        <button id="reiniciarBtn">Reiniciar progreso</button>
    </div>

    <div class="malla" id="mallaContainer"></div>

<script type="module">
    // (Mant√©n aqu√≠ tu configuraci√≥n de Firebase initializeApp, auth y db igual que antes)
    // ... importaciones y firebaseConfig ...

    const mensajes = [
        { min: 0, msg: "Todo gran proyecto empieza con una idea üå±" },
        { min: 10, msg: "Poniendo los primeros cimientos üèóÔ∏è" },
        { min: 30, msg: "Dise√±ando tu futuro, paso a paso üìê" },
        { min: 50, msg: "¬°Mitad de carrera! Ya casi eres arquitecto/a üèõÔ∏è" },
        { min: 75, msg: "La estructura est√° s√≥lida, falta poco para el acabado üé®" },
        { min: 90, msg: "¬°Preparando la entrega final! üéì" },
        { min: 100, msg: "¬°Felicidades Arquitecto/a! Proyecto completado üåü" }
    ];

    function actualizarMensaje(porcentaje) {
        const texto = [...mensajes].reverse().find(m => porcentaje >= m.min);
        document.getElementById('mensajeMotivacion').textContent = texto ? texto.msg : mensajes[0].msg;
    }

    function renderMalla() {
        const container = document.getElementById('mallaContainer');
        container.innerHTML = '';
        let totalMat = 0, aprobadasCount = 0;

        mallaData.forEach(anio => {
            const anioDiv = document.createElement('div');
            anioDiv.className = 'anio';
            anioDiv.innerHTML = `<h2>${anio.anio}</h2>`;

            anio.semestres.forEach(sem => {
                const semDiv = document.createElement('div');
                semDiv.className = 'semestre';
                semDiv.innerHTML = `<h3>${sem.nombre}</h3>`;

                sem.materias.forEach(m => {
                    totalMat++;
                    const esAprobada = aprobadas[m.nombre];
                    if(esAprobada) aprobadasCount++;

                    const bloqueada = !m.prereq.every(p => aprobadas[p]);
                    const mDiv = document.createElement('div');
                    mDiv.className = `materia ${esAprobada ? 'aprobada' : ''} ${bloqueada && !esAprobada ? 'bloqueada' : ''}`;
                    mDiv.textContent = m.nombre;
                    
                    // Tooltip din√°mico
                    if (bloqueada && !esAprobada) {
                        const faltan = m.prereq.filter(p => !aprobadas[p]);
                        mDiv.setAttribute('data-tooltip', `üîí Prerrequisitos: ${faltan.join(", ")}`);
                    } else if (esAprobada) {
                        mDiv.setAttribute('data-tooltip', `‚úÖ Materia aprobada`);
                    } else {
                        mDiv.setAttribute('data-tooltip', `üîì Disponible para marcar`);
                    }

                    mDiv.onclick = () => { if (!bloqueada || esAprobada) toggleMateria(m.nombre); };
                    semDiv.appendChild(mDiv);
                });
                anioDiv.appendChild(semDiv);
            });
            container.appendChild(anioDiv);
        });

        const porc = Math.round((aprobadasCount / totalMat) * 100) || 0;
        document.getElementById('progresoFill').style.width = porc + '%';
        document.getElementById('porcentajeProgreso').textContent = `Progreso: ${porc}%`;
        actualizarMensaje(porc);
    }

    // (Mant√©n el resto de tus funciones toggleMateria y onAuthStateChanged igual)
</script>
</body>
</html>
