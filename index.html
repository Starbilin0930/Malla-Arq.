<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Curricular Arquitectura âœ¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root {
            --verde-fondo: #f4f7f0;
            --verde-fuente: #4c662b;
            --verde-primario: #a3c585;
            --verde-oscuro: #6b8e23;
            --blanco: #ffffff;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--verde-fondo);
            margin: 0;
            color: var(--verde-fuente);
            background-image: radial-gradient(#dce6d1 0.5px, transparent 0.5px);
            background-size: 20px 20px;
        }

        /* --- LOGIN --- */
        #loginScreen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--verde-fondo);
            display: flex; justify-content: center; align-items: center;
            z-index: 9999;
        }

        /* --- ENCABEZADO (CON FIX DE CLIC) --- */
        .header-container {
            position: relative;
            z-index: 5; /* Bajo para no tapar nada */
            pointer-events: none; /* Los clics pasan a travÃ©s hacia las materias */
            padding-top: 40px;
        }
        
        /* Habilitar clics solo en los botones del header */
        #reiniciarBtn { pointer-events: auto; }

        .titulo-malla {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5rem;
            margin: 0;
            color: var(--verde-oscuro);
        }

        /* Barra de Progreso */
        .progreso-container { margin: 20px auto 40px; max-width: 800px; }
        .barra-bg {
            width: 90%; height: 16px; background-color: #e2ecd7;
            border-radius: 50px; overflow: hidden; margin: 15px auto;
        }
        .barra-fill { 
            height: 100%; background: linear-gradient(90deg, var(--verde-primario), #b8d59a); 
            width: 0%; transition: width 1s ease; 
        }

        /* --- MALLA (Z-INDEX ALTO PARA CLICS) --- */
        .malla-scroll { 
            display: flex; 
            gap: 30px; 
            overflow-x: auto; 
            padding: 20px 30px 150px 30px; 
            position: relative;
            z-index: 100; /* ESTO ASEGURA QUE ESTÃ‰ POR ENCIMA DE TODO */
        }
        
        .anio-card { 
            min-width: 300px; 
            background: rgba(255, 255, 255, 0.7); 
            border-radius: 35px; 
            padding: 25px; 
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.8);
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        /* MATERIAS */
        .materia {
            background: var(--blanco); 
            padding: 14px; 
            margin: 12px 0; 
            border-radius: 18px;
            font-size: 0.85rem; 
            cursor: pointer; 
            position: relative; 
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        
        .materia:active { transform: scale(0.95); }

        .materia.aprobada { 
            background-color: var(--verde-primario) !important; 
            color: white; 
            text-decoration: line-through; 
        }
        .materia.bloqueada { color: #bcc7b0; background: #fdfdfd; cursor: not-allowed; }

        /* Tooltip */
        .materia::after {
            content: attr(data-tooltip);
            position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%);
            background: rgba(40, 60, 20, 0.95); color: white; padding: 8px 12px; border-radius: 12px;
            font-size: 0.75rem; width: 160px; z-index: 200; opacity: 0; visibility: hidden; transition: 0.2s;
            pointer-events: none;
        }
        .materia:hover::after { opacity: 1; visibility: visible; }

        /* CONTROLES FLOTANTES */
        .controles-flotantes {
            position: fixed; bottom: 30px; right: 30px;
            display: flex; flex-direction: column; gap: 15px; z-index: 1000;
            pointer-events: none;
        }
        .btn-float {
            width: 60px; height: 60px; border-radius: 50%; border: none;
            background: var(--verde-primario); color: white; font-size: 1.5rem;
            cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            display: flex; align-items: center; justify-content: center;
            pointer-events: auto;
        }
    </style>
</head>
<body>

    <div id="loginScreen">
        <div style="background: white; padding: 50px; border-radius: 40px; text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.1);">
            <h1 style="font-family: 'Dancing Script'; font-size: 2.5rem; color: var(--verde-oscuro);">Hola Arquitecta âœ¨</h1>
            <button id="googleBtn" style="background: white; border: 1px solid #eee; padding: 14px; border-radius: 50px; cursor: pointer; font-weight: 700; display: flex; align-items: center; gap: 10px; margin-top: 20px;">
                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" width="18"> Entrar con Google
            </button>
        </div>
    </div>

    <div id="mainContent" style="display:none;">
        <div class="header-container">
            <h1 class="titulo-malla">Malla Curricular Arquitectura</h1>
            <div class="progreso-container">
                <p id="txtProgreso" style="font-weight: 700;">Avance: 0%</p>
                <div class="barra-bg"><div id="fillProgreso" class="barra-fill"></div></div>
                <p id="fraseMotivadora" style="font-style: italic; color: #88a070; margin-bottom: 5px;"></p>
                <button id="reiniciarBtn">Reiniciar progreso</button>
            </div>
        </div>

        <div class="malla-scroll" id="mallaGrid"></div>

        <div class="controles-flotantes">
            <button id="pdfBtn" class="btn-float">ðŸ“„</button>
            <button id="logoutBtn" class="btn-float" style="background:#d1d9c7; color:#4c662b;">âœ•</button>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBwu2ccI0usOv4c4SmYAKrOMSLZYGh6Mew",
        authDomain: "malla-curricular-de-arq.firebaseapp.com",
        projectId: "malla-curricular-de-arq",
        storageBucket: "malla-curricular-de-arq.firebasestorage.app",
        messagingSenderId: "922660318162",
        appId: "1:922660318162:web:d03fc6ae04a91792e2f60b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    let usuarioActual = null;
    let aprobadas = {};

    // DATOS MALLA
    const mallaData = [
        { anio: "AÃ‘O 1", semestres: [
            { nombre: "1Â° SEMESTRE", materias: [{nombre:"DiseÃ±o ArquitectÃ³nico 1", prereq:[]}, {nombre:"ComposiciÃ³n ArquitectÃ³nica 1", prereq:[]}, {nombre:"IntroducciÃ³n A La TeorÃ­a", prereq:[]}, {nombre:"Arte: AntigÃ¼edad A S. XVIII", prereq:[]}, {nombre:"RepresentaciÃ³n ArquitectÃ³nica 1", prereq:[]}, {nombre:"IntroducciÃ³n A La EdificaciÃ³n", prereq:[]}, {nombre:"MatemÃ¡tica Aplicada", prereq:[]}] },
            { nombre: "2Â° SEMESTRE", materias: [{nombre:"FÃ­sica Aplicada", prereq:["MatemÃ¡tica Aplicada"]}, {nombre:"DiseÃ±o ArquitectÃ³nico 2", prereq:["DiseÃ±o ArquitectÃ³nico 1","ComposiciÃ³n ArquitectÃ³nica 1","IntroducciÃ³n A La TeorÃ­a","RepresentaciÃ³n ArquitectÃ³nica 1","IntroducciÃ³n A La EdificaciÃ³n"]}, {nombre:"ComposiciÃ³n ArquitectÃ³nica 2", prereq:["ComposiciÃ³n ArquitectÃ³nica 1","DiseÃ±o ArquitectÃ³nico 1"]}, {nombre:"Sistemas Constructivos BÃ¡sicos", prereq:["IntroducciÃ³n A La EdificaciÃ³n"]}, {nombre:"Arte: Moderno Y ContemporÃ¡neo", prereq:["Arte: AntigÃ¼edad A S. XVIII"]}, {nombre:"TopografÃ­a", prereq:["IntroducciÃ³n A La EdificaciÃ³n","MatemÃ¡tica Aplicada"]}, {nombre:"Dibujo A Mano Alzada", prereq:[]}] },
            { nombre: "VERANO", materias: [{nombre:"Taller De DiseÃ±o ArquitectÃ³nico 1", prereq:["RepresentaciÃ³n ArquitectÃ³nica 1","DiseÃ±o ArquitectÃ³nico 2"]}, {nombre:"Taller De VisualizaciÃ³n", prereq:[]}, {nombre:"GeomÃ¡tica", prereq:[]}] }
        ]},
        { anio: "AÃ‘O 2", semestres: [
            { nombre: "1Â° SEMESTRE", materias: [{nombre:"EspaÃ±ol", prereq:[]}, {nombre:"DiseÃ±o ArquitectÃ³nico 3", prereq:["IntroducciÃ³n A La TeorÃ­a","DiseÃ±o ArquitectÃ³nico 2","ComposiciÃ³n ArquitectÃ³nica 2","Sistemas Constructivos BÃ¡sicos","TopografÃ­a","Taller De DiseÃ±o ArquitectÃ³nico 1"]}, {nombre:"InterpretaciÃ³n De La Arquitectura", prereq:["IntroducciÃ³n A La TeorÃ­a"]}, {nombre:"RepresentaciÃ³n ArquitectÃ³nica 2", prereq:["RepresentaciÃ³n ArquitectÃ³nica 1"]}, {nombre:"TecnologÃ­a Del HormigÃ³n Armado", prereq:["IntroducciÃ³n A La EdificaciÃ³n","Sistemas Constructivos BÃ¡sicos"]}, {nombre:"Modelos Estructurales", prereq:["FÃ­sica Aplicada"]}, {nombre:"IntroducciÃ³n A La InvestigaciÃ³n", prereq:[]}] },
            { nombre: "2Â° SEMESTRE", materias: [{nombre:"InglÃ©s", prereq:[]}, {nombre:"Sociedad Medio Ambiente Y Des.", prereq:["DiseÃ±o ArquitectÃ³nico 3","IntroducciÃ³n A La EdificaciÃ³n"]}, {nombre:"DiseÃ±o ArquitectÃ³nico 4", prereq:["DiseÃ±o ArquitectÃ³nico 3","InterpretaciÃ³n De La Arquitectura","RepresentaciÃ³n ArquitectÃ³nica 2","TecnologÃ­a Del HormigÃ³n Armado"]}, {nombre:"Textos Y Contextos De La Arq. Latinoamericana", prereq:["InterpretaciÃ³n De La Arquitectura"]}, {nombre:"RepresentaciÃ³n ArquitectÃ³nica 3 La Arquitectura", prereq:["RepresentaciÃ³n ArquitectÃ³nica 2"]}, {nombre:"Sistemas Constructivos Especiales", prereq:["TecnologÃ­a Del HormigÃ³n Armado"]}, {nombre:"AnÃ¡lisis Estructural", prereq:["Modelos Estructurales"]}] },
            { nombre: "VERANO", materias: [{nombre:"Taller De DiseÃ±o ArquitectÃ³nico 2", prereq:["Taller De DiseÃ±o ArquitectÃ³nico 1","DiseÃ±o ArquitectÃ³nico 4","RepresentaciÃ³n ArquitectÃ³nica 3 La Arquitectura","Sistemas Constructivos Especiales"]}, {nombre:"Electiva 1", prereq:[]}, {nombre:"Electiva 2", prereq:[]}] }
        ]},
        { anio: "AÃ‘O 3", semestres: [
            { nombre: "1Â° SEMESTRE", materias: [{nombre:"Historia De Pma En El Mundo Global", prereq:[]}, {nombre:"DiseÃ±o ArquitectÃ³nico 5", prereq:["DiseÃ±o ArquitectÃ³nico 4","Textos Y Contextos De La Arq. Latinoamericana","RepresentaciÃ³n ArquitectÃ³nica 3 La Arquitectura","Sistemas Constructivos Especiales","Taller De DiseÃ±o ArquitectÃ³nico 2"]}, {nombre:"CrÃ­tica De La Arquitectura Y Pensamiento ContemporÃ¡neo", prereq:["Textos Y Contextos De La Arq. Latinoamericana"]}, {nombre:"RepresentaciÃ³n ArquitectÃ³nica 4", prereq:["RepresentaciÃ³n ArquitectÃ³nica 3 La Arquitectura"]}, {nombre:"Sistema Constructivos Complejos", prereq:["Sistemas Constructivos Especiales"]}, {nombre:"Instalaciones Para Edificio 1", prereq:["FÃ­sica Aplicada"]}, {nombre:"Espacios Abiertos Vecinales", prereq:["Sociedad Medio Ambiente Y Des.","TopografÃ­a","IntroducciÃ³n A La InvestigaciÃ³n","DiseÃ±o ArquitectÃ³nico 4"]}] },
            { nombre: "2Â° SEMESTRE", materias: [{nombre:"GeografÃ­a De PanamÃ¡", prereq:[]}, {nombre:"DiseÃ±o ArquitectÃ³nico 6", prereq:["DiseÃ±o ArquitectÃ³nico 5","CrÃ­tica De La Arquitectura Y Pensamiento ContemporÃ¡neo","RepresentaciÃ³n ArquitectÃ³nica 4","Sistema Constructivos Complejos","Instalaciones Para Edificio 1"]}, {nombre:"Arquitectura Y Ciudad 1", prereq:["Arte: Moderno Y ContemporÃ¡neo"]}, {nombre:"RepresentaciÃ³n ArquitectÃ³nica 5", prereq:["RepresentaciÃ³n ArquitectÃ³nica 4"]}, {nombre:"GestiÃ³n De Seguridad Y Salud Ocupacional", prereq:["Sistema Constructivos Complejos"]}, {nombre:"Instalaciones Para Edificio 2", prereq:["Instalaciones Para Edificio 1"]}, {nombre:"Ciudad Y Comunidad", prereq:["DiseÃ±o ArquitectÃ³nico 5","Espacios Abiertos Vecinales"]}] },
            { nombre: "VERANO", materias: [{nombre:"Taller De DiseÃ±o ArquitectÃ³nico 3", prereq:["Taller De DiseÃ±o ArquitectÃ³nico 2","Sistema Constructivos Complejos","DiseÃ±o ArquitectÃ³nico 5","RepresentaciÃ³n ArquitectÃ³nica 5"]}, {nombre:"PrÃ¡ctica Supervisada 1", prereq:["GestiÃ³n De Seguridad Y Salud Ocupacional"]}, {nombre:"Optativa 1", prereq:[]}] }
        ]},
        { anio: "AÃ‘O 4", semestres: [
            { nombre: "1Â° SEMESTRE", materias: [{nombre:"DiseÃ±o ArquitectÃ³nico 7", prereq:["Sistema Constructivos Complejos","DiseÃ±o ArquitectÃ³nico 6","Instalaciones Para Edificio 2","Taller De DiseÃ±o ArquitectÃ³nico 3","RepresentaciÃ³n ArquitectÃ³nica 5"]}, {nombre:"Arquitectura Y Ciudad 2", prereq:["Sistema Constructivos Complejos","DiseÃ±o ArquitectÃ³nico 6","Instalaciones Para Edificio 2","Taller De DiseÃ±o ArquitectÃ³nico 3","RepresentaciÃ³n ArquitectÃ³nica 5"]}, {nombre:"RepresentaciÃ³n ArquitectÃ³nica 6", prereq:["RepresentaciÃ³n ArquitectÃ³nica 5"]}, {nombre:"Taller De Planos Y Especificaciones", prereq:["IntroducciÃ³n A La InvestigaciÃ³n"]}, {nombre:"DiseÃ±o Estructural Simplificado", prereq:["AnÃ¡lisis Estructural","Sistema Constructivos Complejos"]}, {nombre:"Instalaciones Para Edificas 3", prereq:["Instalaciones Para Edificio 2"]}, {nombre:"Urbanismo", prereq:["GeomÃ¡tica","DiseÃ±o ArquitectÃ³nico 6","Ciudad Y Comunidad"]}] },
            { nombre: "2Â° SEMESTRE", materias: [{nombre:"DiseÃ±o ArquitectÃ³nico 8", prereq:["DiseÃ±o ArquitectÃ³nico 7","RepresentaciÃ³n ArquitectÃ³nica 6","DiseÃ±o Estructural Simplificado","Instalaciones Para Edificios 3"]}, {nombre:"Arquitectura Y Ciudad 3", prereq:["Arquitectura Y Ciudad 2"]}, {nombre:"Presupuesto De Obra", prereq:["Sistema Constructivos Complejos","Taller De Planos Y Especificaciones"]}, {nombre:"Estructuras Especiales", prereq:["DiseÃ±o Estructural Simplificado"]}, {nombre:"Instalaciones Para Edificios 4", prereq:["Instalaciones Para Edificas 3"]}, {nombre:"Espacios Abiertos Urbanos", prereq:["DiseÃ±o ArquitectÃ³nico 7","Urbanismo"]}, {nombre:"MetodologÃ­a Para La Elab. De Tesis", prereq:["DiseÃ±o ArquitectÃ³nico 7","Arquitectura Y Ciudad 2","RepresentaciÃ³n ArquitectÃ³nica 6","Taller De Planos Y Especificaciones","DiseÃ±o Estructural Simplificado","Instalaciones Para Edificio 3","Urbanismo"]}] },
            { nombre: "VERANO", materias: [{nombre:"Taller De Urbanismo", prereq:["DiseÃ±o ArquitectÃ³nico 8","Espacios Abiertos Urbanos"]}, {nombre:"PrÃ¡ctica Supervisada 2", prereq:["PrÃ¡ctica Supervisada 1"]}, {nombre:"Optativa 2", prereq:[]}] }
        ]},
        { anio: "AÃ‘O 5", semestres: [
            { nombre: "1Â° SEMESTRE", materias: [{nombre:"Hist. De Las Relaciones De Pma Con Los EE.UU. I", prereq:[]}, {nombre:"DiseÃ±o ArquitectÃ³nico 9", prereq:["DiseÃ±o ArquitectÃ³nico 8","Estructuras Especiales","Instalaciones Para Edificios 4"]}, {nombre:"Arquitectura Y Ciudad 4", prereq:["Arquitectura Y Ciudad 3"]}, {nombre:"ProgramaciÃ³n Y Control De PYT", prereq:["Taller De Planos Y Especificaciones","Presupuesto De Obra"]}, {nombre:"GestiÃ³n Profesional", prereq:["DiseÃ±o ArquitectÃ³nico 8","PrÃ¡ctica Supervisada 2"]}, {nombre:"Ciudad Y Territorio", prereq:["Taller De Urbanismo"]}, {nombre:"Trabajo De GraduaciÃ³n 1", prereq:["DiseÃ±o ArquitectÃ³nico 7","Arquitectura Y Ciudad 3","RepresentaciÃ³n ArquitectÃ³nica 6","Taller De Planos Y Especificaciones","DiseÃ±o Estructural Simplificado","Instalaciones Para Edificios 3","Urbanismo"]}] },
            { nombre: "2Â° SEMESTRE", materias: [{nombre:"Hist. De Las Relaciones De Pma Con Los EE.UU. II", prereq:[]}, {nombre:"DiseÃ±o ArquitectÃ³nico 10", prereq:["DiseÃ±o ArquitectÃ³nico 9"]}, {nombre:"Patrimonio ArquitectÃ³nico", prereq:["Arquitectura Y Ciudad 4"]}, {nombre:"GestiÃ³n Y Mantenimiento De Edificios", prereq:["PrÃ¡ctica Supervisada 2","ProgramaciÃ³n Y Control De PYT"]}, {nombre:"PrÃ¡ctica Supervisada 3", prereq:["RepresentaciÃ³n ArquitectÃ³nica 6","PrÃ¡ctica Supervisada 2","DiseÃ±o ArquitectÃ³nico 9","ProgramaciÃ³n Y Control De PYT","GestiÃ³n Profesional","Ciudad Y Territorio"]}, {nombre:"GestiÃ³n Urbana Y Territorial", prereq:["Taller De Urbanismo","DiseÃ±o ArquitectÃ³nico 9","GestiÃ³n Profesional","Ciudad Y Territorio"]}, {nombre:"Trabajo De GraduaciÃ³n 2", prereq:["Trabajo De GraduaciÃ³n 1"]}] }
        ]}
    ];

    onAuthStateChanged(auth, (user) => {
        if (user) {
            usuarioActual = user;
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            onSnapshot(doc(db, "usuarios", user.uid), (snap) => {
                aprobadas = snap.exists() ? snap.data().materias : {};
                renderMalla();
            });
        } else {
            document.getElementById('loginScreen').style.display = 'flex';
        }
    });

    function renderMalla() {
        const grid = document.getElementById('mallaGrid');
        grid.innerHTML = '';
        let total = 0, numAp = 0;

        mallaData.forEach(anio => {
            const card = document.createElement('div');
            card.className = 'anio-card';
            card.innerHTML = `<div style="font-size:1.5rem; font-weight:bold; color:var(--verde-oscuro); margin-bottom:15px;">${anio.anio}</div>`;
            
            anio.semestres.forEach(sem => {
                card.innerHTML += `<div style="background:#f0f4eb; font-size:0.8rem; font-weight:bold; padding:8px; border-radius:10px; margin-top:15px;">${sem.nombre}</div>`;
                sem.materias.forEach(m => {
                    total++;
                    const esAprobada = aprobadas[m.nombre];
                    if(esAprobada) numAp++;
                    const bloqueada = !m.prereq.every(p => aprobadas[p]);

                    const mDiv = document.createElement('div');
                    mDiv.className = `materia ${esAprobada ? 'aprobada' : ''} ${bloqueada && !esAprobada ? 'bloqueada' : ''}`;
                    mDiv.textContent = m.nombre;

                    // TOOLTIPS Y EMOJIS
                    if (bloqueada && !esAprobada) {
                        const faltan = m.prereq.filter(p => !aprobadas[p]);
                        mDiv.setAttribute('data-tooltip', `ðŸ”’ Faltan: ${faltan.join(", ")}`);
                    } else if (esAprobada) {
                        mDiv.setAttribute('data-tooltip', `âœ… Â¡Completada!`);
                    } else {
                        mDiv.setAttribute('data-tooltip', `ðŸ”“ Lista para cursar`);
                    }

                    mDiv.onclick = (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        if(!bloqueada || esAprobada) toggleMateria(m.nombre);
                    };
                    card.appendChild(mDiv);
                });
            });
            grid.appendChild(card);
        });

        const porc = Math.round((numAp/total)*100) || 0;
        document.getElementById('fillProgreso').style.width = porc + '%';
        document.getElementById('txtProgreso').textContent = `Avance: ${porc}%`;
        
        const frases = ["Â¡Empecemos este diseÃ±o! ðŸŒ±", "Â¡Vas muy bien! âœ¨", "Â¡A mitad del camino! ðŸ›ï¸", "Â¡Casi arquitecta! ðŸŽ“"];
        document.getElementById('fraseMotivadora').textContent = frases[Math.floor(porc/30)] || frases[3];
    }

    async function toggleMateria(n) {
        aprobadas[n] ? delete aprobadas[n] : aprobadas[n] = true;
        await setDoc(doc(db, "usuarios", usuarioActual.uid), { materias: aprobadas });
    }

    document.getElementById('googleBtn').onclick = () => signInWithPopup(auth, provider);
    document.getElementById('logoutBtn').onclick = () => signOut(auth);
    document.getElementById('reiniciarBtn').onclick = async () => {
        if(confirm("Â¿Borrar todo el progreso?")) await setDoc(doc(db, "usuarios", usuarioActual.uid), { materias: {} });
    };

    document.getElementById('pdfBtn').onclick = () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("Mi Avance de Arquitectura", 20, 20);
        const lista = [];
        mallaData.forEach(anio => anio.semestres.forEach(sem => sem.materias.forEach(m => {
            lista.push([anio.anio, sem.nombre, m.nombre, aprobadas[m.nombre] ? "Aprobada" : "Pendiente"]);
        })));
        doc.autoTable({ head: [['AÃ±o', 'Semestre', 'Materia', 'Estado']], body: lista, startY: 30 });
        doc.save("Mi_Malla.pdf");
    };
</script>
</body>
</html>
